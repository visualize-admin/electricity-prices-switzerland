enum CacheControlScope {
  PUBLIC
  PRIVATE
}

directive @cacheControl(
  maxAge: Int
  scope: CacheControlScope
  inheritMaxAge: Boolean
) on FIELD_DEFINITION | OBJECT | INTERFACE | UNION

interface SearchResult {
  id: String!
  name: String!
}
type MunicipalityResult implements SearchResult {
  id: String!
  name: String!
}
type OperatorResult implements SearchResult {
  id: String!
  name: String!
}
type CantonResult implements SearchResult {
  id: String!
  name: String!
}

type Municipality @cacheControl(maxAge: 300) {
  id: String!
  name: String!
  isAbolished: Boolean
  canton: Canton!
  operators: [Operator!]!
}

# Come from the database, no settlement density or energy density yet
type PeerGroupItem {
  id: String!
  name: String!
}

type PeerGroup @cacheControl(maxAge: 300) {
  id: String!
  settlementDensity: String!
  energyDensity: String!
}

type Operator @cacheControl(maxAge: 300) {
  id: String
  geverId: String
  name: String!
  municipalities: [Municipality!]!
  cantons: [Canton!]!
  documents: [OperatorDocument!]!
  geverDocuments: [OperatorDocument!]!
  peerGroup: PeerGroup
}

enum OperatorDocumentCategory {
  TARIFFS
  FINANCIAL_STATEMENT
  ANNUAL_REPORT
}

type OperatorDocument @cacheControl(maxAge: 300) {
  id: String!
  name: String!
  url: String!
  year: String!
  category: OperatorDocumentCategory
}

type OperatorMunicipality @cacheControl(maxAge: 300) {
  municipality: Int!
  canton: String!
  operator: String!
}

type Canton {
  id: String!
  name: String!
  municipalities: [Municipality!]!
  operator: [Operator!]!
}

type OperatorObservation @cacheControl(maxAge: 300) {
  municipality: String!
  municipalityLabel: String
  operator: String!
  operatorLabel: String
  canton: String!
  cantonLabel: String
  category: String!
  period: String!
  value(priceComponent: PriceComponent!): Float
  coverageRatio: Float!
}

type CantonMedianObservation @cacheControl(maxAge: 300) {
  canton: String!
  cantonLabel: String

  category: String!
  period: String!

  value(priceComponent: PriceComponent!): Float!
}

type SwissMedianObservation @cacheControl(maxAge: 300) {
  category: String!
  period: String!

  value(priceComponent: PriceComponent!): Float!
}

union Observation =
    OperatorObservation
  | CantonMedianObservation
  | SwissMedianObservation

input ObservationFilters {
  period: [String!]
  municipality: [String!]
  canton: [String!]
  operator: [String!]
  category: [String!]
  product: [String!]
}

enum PriceComponent {
  aidfee
  fixcosts
  charge
  gridusage
  energy
  fixcostspercent
  total
  annualmeteringcost
  meteringrate
}

enum ObservationKind {
  Canton
  Municipality
}

scalar WikiContentInfo
type WikiContent @cacheControl(maxAge: 60) {
  html: String!
  info: WikiContentInfo
}

type SystemInfo {
  SPARQL_ENDPOINT: String!
  VERSION: String!
}

type CubeHealth {
  ok: Boolean!
  dimensions: [String!]!
}

type Query {
  systemInfo: SystemInfo!
  municipalities(
    locale: String!
    query: String
    ids: [String!]
  ): [Municipality!]!
  allMunicipalities(locale: String!): [Municipality!]!
    @cacheControl(maxAge: 300)
  cantons(locale: String!, query: String, ids: [String!]): [Canton!]!

  operators(locale: String!, query: String, ids: [String!]): [Operator!]!

  peerGroups(locale: String!): [PeerGroupItem!]! @cacheControl(maxAge: 300)

  search(locale: String!, query: String): [SearchResult!]!
    @cacheControl(maxAge: 300)

  searchMunicipalities(
    locale: String!
    query: String
    ids: [String!]
  ): [MunicipalityResult!]! @cacheControl(maxAge: 300)
  searchCantons(
    locale: String!
    query: String
    ids: [String!]
  ): [CantonResult!]! @cacheControl(maxAge: 300)
  searchOperators(
    locale: String!
    query: String
    ids: [String!]
  ): [OperatorResult!]! @cacheControl(maxAge: 300)

  municipality(locale: String!, id: String!): Municipality
  canton(locale: String!, id: String!): Canton
  operator(locale: String!, id: String!, geverId: String): Operator

  observations(
    locale: String
    filters: ObservationFilters
    observationKind: ObservationKind
  ): [OperatorObservation!] @cacheControl(maxAge: 300)

  cantonMedianObservations(
    locale: String
    filters: ObservationFilters
    observationKind: ObservationKind
  ): [CantonMedianObservation!] @cacheControl(maxAge: 300)

  swissMedianObservations(
    locale: String
    filters: ObservationFilters
  ): [SwissMedianObservation!] @cacheControl(maxAge: 300)

  wikiContent(locale: String!, slug: String!): WikiContent
    @cacheControl(maxAge: 300)

  operatorMunicipalities(
    period: String!
    electricityCategory: String
  ): [OperatorMunicipality!]! @cacheControl(maxAge: 300)

  cubeHealth: CubeHealth
}

type SunshineDataRow @cacheControl(maxAge: 300) {
  operatorId: Int
  operatorUID: String!
  name: String!
  period: String!
  francRule: Float
  infoYesNo: Boolean
  infoDaysInAdvance: Int
  productsCount: Int
  productsSelection: Boolean
  timely: Boolean
  saidiTotal: Float
  saidiUnplanned: Float
  saifiTotal: Float
  saifiUnplanned: Float
  tariffEC2: Float
  tariffEC3: Float
  tariffEC4: Float
  tariffEC6: Float
  tariffEH2: Float
  tariffEH4: Float
  tariffEH7: Float
  tariffNC2: Float
  tariffNC3: Float
  tariffNC4: Float
  tariffNC6: Float
  tariffNH2: Float
  tariffNH4: Float
  tariffNH7: Float
  networkCostsNE5: Float
  networkCostsNE6: Float
  networkCostsNE7: Float
}

type SunshineDataIndicatorRow @cacheControl(maxAge: 300) {
  operatorId: Int
  operatorUID: String!
  name: String!
  period: String!
  value: Float
}

type SunshineDataByIndicatorResult @cacheControl(maxAge: 300) {
  data: [SunshineDataIndicatorRow!]!
  median: Float
}

input SunshineDataFilter {
  operatorId: Int
  period: String
  peerGroup: String
  indicator: String
  category: String
  networkLevel: String
  saidiSaifiType: String
}

# TODO Map more closely to predefined strings
scalar ElectricityCategory

enum Trend {
  up
  down
  stable
}

type NetworkCostsData @cacheControl(maxAge: 300) {
  networkLevel: NetworkLevel!
  operatorRate: Float
  operatorTrend: Trend
  peerGroupMedianRate: Float
  peerGroupMedianTrend: Trend
  yearlyData: [NetworkCostRow!]!
}

type NetworkLevel @cacheControl(maxAge: 300) {
  id: String!
}

type NetworkCostRow @cacheControl(maxAge: 300) {
  year: Int!
  rate: Float
  operator_id: Int!
  operator_name: String!
  network_level: String!
}

type TariffsData @cacheControl(maxAge: 300) {
  category: ElectricityCategory!
  operatorRate: Float
  operatorTrend: Trend
  peerGroupMedianRate: Float
  peerGroupMedianTrend: Trend
  yearlyData: [TariffRow!]!
}

type TariffRow @cacheControl(maxAge: 300) {
  period: Int!
  rate: Float
  operator_id: Int!
  operator_name: String!
  category: ElectricityCategory!
}

input NetworkCostsFilter {
  operatorId: Int!
  networkLevel: String!
  period: Int!
  operatorOnly: Boolean
}

input TariffsFilter {
  operatorId: Int!
  category: String!
  period: Int!
  operatorOnly: Boolean
}

type StabilityDataRow @cacheControl(maxAge: 300) {
  year: Int!
  total: Float
  unplanned: Float
  operator_id: Int!
  operator_name: String!
}

type StabilityData @cacheControl(maxAge: 300) {
  operatorTotal: Float
  operatorUnplanned: Float
  trendTotal: Trend
  trendUnplanned: Trend
  peerGroupMedianTotal: Float!
  peerGroupMedianUnplanned: Float!
  peerGroupMedianTrendTotal: Trend!
  peerGroupMedianTrendUnplanned: Trend!
  yearlyData: [StabilityDataRow!]!
}

input StabilityFilter {
  operatorId: Int!
  year: Int!
  operatorOnly: Boolean
}

type OperationalStandardsServiceQuality @cacheControl(maxAge: 300) {
  notificationPeriodDays: Int
  informingCustomersOfOutage: Boolean
  operatorsNotificationPeriodDays: [OperationalStandardsOperatorNotification!]!
}

type OperationalStandardsOperatorNotification @cacheControl(maxAge: 300) {
  operatorId: String!
  days: Int
  year: String!
}

type OperationalStandardsCompliance @cacheControl(maxAge: 300) {
  francsRule: String
  timelyPaperSubmission: Boolean
  operatorsFrancsPerInvoice: [OperationalStandardsOperatorFrancs!]!
}

type OperationalStandardsOperatorFrancs @cacheControl(maxAge: 300) {
  operatorId: String!
  francsPerInvoice: Float
  year: String!
}

type OperatorWithPeerGroup @cacheControl(maxAge: 300) {
  peerGroup: PeerGroup!
}

type OperationalStandardsData @cacheControl(maxAge: 300) {
  latestYear: String!
  operator: OperatorWithPeerGroup!
  serviceQuality: OperationalStandardsServiceQuality!
  compliance: OperationalStandardsCompliance!
  updateDate: String!
}

input OperationalStandardsFilter {
  operatorId: Int!
  period: Int
}

input CostsAndTariffsFilter {
  operatorId: Int!
  period: Int
  networkLevel: String!
  category: String!
  operatorOnly: Boolean
}

input PowerStabilityFilter {
  operatorId: Int!
  period: Int
  operatorOnly: Boolean
}

type CostsAndTariffsData @cacheControl(maxAge: 300) {
  latestYear: String!
  operator: OperatorWithPeerGroup!
  networkCosts: NetworkCostsData!
  netTariffs: TariffsData!
  energyTariffs: TariffsData!
  updateDate: String!
}

type PowerStabilityData @cacheControl(maxAge: 300) {
  latestYear: String!
  operator: OperatorWithPeerGroup!
  saidi: StabilityData!
  saifi: StabilityData!
  updateDate: String!
}

type Query {
  sunshineData(filter: SunshineDataFilter!): [SunshineDataRow!]!
  sunshineTariffs(filter: SunshineDataFilter!): [SunshineDataRow!]!
  sunshineDataByIndicator(
    filter: SunshineDataFilter!
  ): SunshineDataByIndicatorResult!
  sunshineMedianByIndicator(filter: SunshineDataFilter!): Float
  sunshineTariffsByIndicator(
    filter: SunshineDataFilter!
    indicator: String!
  ): [SunshineDataIndicatorRow!]!

  networkCosts(filter: NetworkCostsFilter!): NetworkCostsData!
  netTariffs(filter: TariffsFilter!): TariffsData!
  energyTariffs(filter: TariffsFilter!): TariffsData!

  saidi(filter: StabilityFilter!): StabilityData!
  saifi(filter: StabilityFilter!): StabilityData!
  operationalStandards(
    filter: OperationalStandardsFilter!
  ): OperationalStandardsData!
  costsAndTariffs(filter: CostsAndTariffsFilter!): CostsAndTariffsData!
  powerStability(filter: PowerStabilityFilter!): PowerStabilityData!
}
